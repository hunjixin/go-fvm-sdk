# Introduction

At present, filecoin is actively promoting wasm-based virtual machine projects. One of the main reasons is that wasm is an intermediate language, which can translate other languages into wasm code, so that fvm can capitalize existing results on different languages quickly.

go-fvm-sdk will be implemented in three parts:

1. Utilize existing solution or implement a new tool to translate tinygo into wasm. The reason why tinygo is used here is that under the current implementation, tinygo supports wasi mode, but go transform is based on the assumption that wasm running on browser, so golang cannot translate pure wasm code

2. Implement SDK of the go language Based On the protocol of the fvm system call. which mainly includes the implementation of interface of all the system calls of the fvm.

3. base on actual usage, provide some commonly used go language libraries, which may be a FVM-compatible version reimplemented from the go system library, or a common library integrated from the filecoin project

# Motivations

1. Go language syntax is simple, easy to learn and use. Higher development efficiency

2. The go language basic library is very rich, with the implementation of most common used libraries and algorithms in the blockchain subject.

3. Most of the algorithms used in filecoin have implementation in golang

4. The current implementation of go / tinygo has ablity of transforming go language to wasm, although it may not be perfect.

# Goals

1. Generate clean wasm code from go and run normally in FVM

2. Fully implement the SDK and completely match the system call of FVM

3. Wasm generated by go language can interact normally with other contracts (including native contracts / contracts generated by trust / contracts generated by go) in FVM environment.

4. In order to improve the execution efficiency of go-fvm-sdk code, this project explores an unsafe programming to manually manage memory in GC environment

# Risks

1. When the wasm generated by go interacts with the native contract or other contracts, can the parameters be passed correctly and the return value can be obtained normally, especially complex types (structure / string / array)

2. Since the system library in go may use the system call, is there any common used system library that cannot run on FVM when using the system library in the contract.if it exists, some libraries may need to be rewritten

3. Wasm translated from different languages (go / trust) may have different methods to processing memory. this may lead to incompatibility.

4. When the code generated by go runs on FVM, whether there are any memory limit, and whether there are serious problems in execution efficiency and memory issue due to the existence of GC. for example, unreasonable memory growth and too many operation instructions.

5. if go-fvm-sdk uses gc mode, will gc damage the memory space of rust-wasm when grow the manage memory space.

# Refrence

[example for convert tinygo to wasm](https://tinygo.org/docs/guides/webassembly/)

[tinygo compiler cmds](https://tinygo.org/docs/reference/usage/important-options/)

[tinygo conservative blog](https://aykevl.nl/2020/09/gc-tinygo)

[tinygo conservative implementation](https://github.com/tinygo-org/tinygo/blob/master/src/runtime/gc_conservative.go)

[wasm instruction](https://webassembly.github.io/spec/core/syntax/instructions.html)
